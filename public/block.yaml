meta:
  study_id: "MPhil-2048-v1"
  version: "1.1.1"

global:
  board_size: 4
  spawn_rates: {"2": 0.9, "4": 0.1}   # default; blocks can override
  autosave_every_ms: 5000

blocks:

  # ——— Baseline (neutral) ———
  - id: "baseline_rest"
    type: "rest"
    description: "Neutral screen"
    stop: { kind: "time", value: 10 }
    ui:
      palette: "neutral"
      show_message: "Relax. Baseline recording."

  - id: "easy_mode"
    type: "play"
    description: "Warm-up round"
    board_size: 4
    goal_tile: 128
    start_state:
      classic: true
    rules:
      undo_allowed: true
      hints: true
    spawn:
      rates: {"2": 0.9, "4": 0.1}
    ui:
      palette: "soft"
      feedback: ["Nice start!", "Keep going!"]
      animation_speed: "slow"
    audio:
      music: "tempo_easy"
      sfx: "subtle_particles"

  - id: "tests_after_easy"
    type: "tests"
    tests: ["TLX","SAM","Stroop"]
    tests_options:
      TLX:
        omit_dimensions: ["temporal_demand"]

  # ——— Medium Mode ———
  - id: "medium_mode"
    type: "play"
    description: "Balanced challenge — 1:30 timer"
    board_size: 4
    goal_tile: 256                 # CHANGED
    start_state:
      classic: true
    rules:
      undo_allowed: false
      hints: false
    stop:
      kind: "time"
      value: 90                    # CHANGED (1:30)
    timer:
      hard_cap_sec: 90             # CHANGED (1:30)
      show_countdown: true
    spawn:
      rates: {"2": 0.9, "4": 0.1}
    ui:
      palette: "bright_contrast"
      feedback: ["Good strategy!", "Smart combo!"]
      animation_speed: "medium"
    audio:
      music: "tempo_medium"
      sfx: "subtle_particles"

  # ——— Tests after Medium ———
  - id: "tests_after_medium"
    type: "tests"
    tests: ["TLX","SAM","Stroop"]

  # ——— Hard Mode ———
  - id: "hard_mode"
    type: "play"
    description: "Intense challenge — 35% prefilled; bias spawns to 2"
    board_size: 4
    goal_tile: 1024
    start_state:
      classic: false
      prefill:
        fill_ratio: 0.35               # CHANGED
        # Include 2s and 4s mostly; keep some higher tiles for variety
        values: {"2": 0.60, "4": 0.25, "8": 0.10, "16": 0.05}
    rules:
      undo_allowed: false
      hints: false
    stop:
      kind: "time"
      value: 60                         # keep 1 minute
    timer:
      hard_cap_sec: 60
      show_countdown: true
    spawn:
      rates: {"2": 0.95, "4": 0.05}     # CHANGED: more 2s
    ui:
      palette: "high_contrast"
      feedback: ["Focus!", "Fast moves!", "Good merge!", "Stay sharp!"]
      animation_speed: "fast"
    audio:
      music: "tempo_hard"
      sfx: "crisp"

  # ——— Tests after Hard ———
  - id: "tests_after_hard"
    type: "tests"
    tests: ["TLX","SAM","Stroop"]

  # ——— Oddball Mode ———
  - id: "oddball_mode"
    type: "play"
    description: "Oddball task — visual attention test"
    board_size: 4
    goal_tile: 512
    start_state:
      classic: true
    stop:
      kind: "time"
      value: 90
    timer:
      hard_cap_sec: 90
      show_countdown: true
    spawn:
      rates: {"2": 0.9, "4": 0.1}   # normal spawn
    ui:
      palette: "bright_contrast"
      feedback: ["Focus!", "Stay alert!", "Good catch!"]
      animation_speed: "medium"
    audio:
      music: "tempo_medium"
      sfx: "subtle_particles"
    post_questions:
      - type: "single"
        id: "saw_flash"
        text: "Did you notice the flashes?"
        options: ["Yes", "No"]
      - type: "scale"
        id: "flash_count"
        text: "How many flashes did you see?"
        min: 0
        max: 2
        labels: ["0","1","2"]

  # ——— Tests after Oddball ———
  - id: "tests_after_oddball"
    type: "tests"
    tests: ["TLX", "SAM", "Stroop"]

sequence:
  - baseline_rest
  - easy_mode
  - tests_after_easy
  - medium_mode
  - tests_after_medium
  - hard_mode
  - tests_after_hard
  - oddball_mode
  - tests_after_oddball

output:
  autosave_csv_on_block_end: true
  filename_pattern: "{study_id}__{block_id}__{ts}.csv"